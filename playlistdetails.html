<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Playlist Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #121212;
      color: white;
      padding: 2rem;
    }


    .album-header{
      width: 800px;
      height: 250px;
      position: relative;
      right: 31px;
      bottom: 32px;
      transition: background 0.5s ease;
      display: flex;
    }


    .cover-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-left: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .cover-image {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }
    .cover-image:hover {
      transform: scale(1.05);
    }


    .playlist-details {
      max-width: 60%;
      position: absolute;
      left: 195px;
      top: 80px;
    }
     #playlistTitle {
      width: 480px;
      height: 60px;
      font-size: 1.6rem;
      font-weight: 1000;
      line-height: 30px;
      letter-spacing: -1px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2; 
      -webkit-box-orient: vertical;
    }
    #playlistDesc{
      color: bisque;
      margin-top: 0px;
      font-size: 0.7rem;
      font-weight: bold;
    }

/*    HEADING NO     */
    .pre-heading{
      background-color: #1db954;
    }
    .heading {
      margin-bottom: 10px;
      font-size: 0.7rem;
      color: #aaa;
      background-color: ;
      border-bottom: 0.5px ridge;
      border-color: #aaa;
      justify-content: center;
    }
    .heading-info{
      display: flex;
      align-items: center;
      height: 20px;
      padding-top: 15px;
      padding-left: 0px;
    }
    .heading-no{
      padding-left: 14px;
    }
    .heading-title{
      padding-left: 10px;
    }
    .heading-album{
      padding-left: 385px;
    }




    h1 {
      font-weight: bold;
      margin-bottom: 2rem;
    }

    .song-row { 
      margin-top: 10px;
      background-color: ;
      display: flex;
      align-items: center;
      transition: background 0.2s;
      position: relative;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 3px;
      height: 45px;
    }
    .song-row:hover {
      background-color: #3a3a3a;
    }
    .song-number {
     width: 24px;
     height: 24px;
     border-radius: 50%;
     background-color: transparent;
     color: #ccc;
     display: flex;
     justify-content: center;
     align-items: center;
     font-size: 12px;
     margin-right: 5px;
     position: relative;
     transition: all 0.3s ease;
    }
    .song-thumb {
      width: 35px;
      border-radius: 5px;
      object-fit: cover;
      margin-right: 10px;
    }
    .song-info {
      flex-grow: 1;
    }
    .song-title {
      margin: 0;
      font-weight: bold;
      font-size: 0.75rem;
      width: 215px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .song-artist {
      margin: 0;
      font-weight: bold;
      font-size: 0.70rem;
      width: 215px;
      color: #aaa;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .dropdown-menu {
      font-weight: 600;
      color: #aaa;
      background-color: #333;
      border-radius: 8px;
      display: none;
      left: 20%;

    }
    .dropdown-item {
      color: white;
      cursor: pointer;
    }
    .dropdown-item:hover {
      background-color: #444;
    }
    .dropdown-button {
      background: none;
      border: none;
      color: #ccc;
      font-size: 20px;
      cursor: pointer;
      transition: color 0.2s;

    }
    .dropdown-button:hover {
      color: white;
    }





    .edit-btn {
      background-color: #1db954;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    .edit-btn:hover {
      background-color: #17a34a;
    }
    .action-buttons {
      margin-top: 10px;
    }
    .action-buttons button {
      margin-right: 10px;
    }
    .custom-modal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.6);
      animation: fadeIn 0.3s ease forwards;
    }
    .custom-modal.show {
      display: block;
    }
    .custom-modal-dialog {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background-color: #222;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      padding: 20px;
      color: white;
      animation: slideUp 0.3s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from {
        transform: translate(-50%, 60%) scale(0.9);
        opacity: 0;
      }
      to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    #existingPlaylists {
      max-height: 200px;
      overflow-y: auto;
      background-color: #2a2a2a;
      padding: 10px;
      border-radius: 6px;
    }

    .playlist-option {
      padding: 8px 10px;
      border-radius: 5px;
      margin-bottom: 6px;
      background-color: #3a3a3a;
      cursor: pointer;
      transition: background 0.2s;
    }

    .playlist-option:hover {
      background-color: #4a4a4a;
    }

        /* Body scrollbar - thin and dark */
body::-webkit-scrollbar {
  width: 6px;
}

body::-webkit-scrollbar-track {
  background: #1e1e1e;
  border-radius: 4px;
}

body::-webkit-scrollbar-thumb {
  background-color: #555;
  border-radius: 10px;
}

/* Optional: on hover, thumb becomes lighter */
body::-webkit-scrollbar-thumb:hover {
  background-color: #888;
}
  </style>
</head>

<body>



<!-- Copy Notification -->
<div id="copyNotification" style="position: fixed; bottom: 20px; right: 20px; background-color: #1db954; color: white; padding: 10px 20px; border-radius: 8px; display: none; z-index: 999;">Link copied!</div>

  <!-- Edit Playlist Modal -->
<div id="editPlaylistModal" class="custom-modal">
  <div class="custom-modal-dialog">
    <h5>Edit Playlist</h5>
    <input type="text" id="editPlaylistName" class="form-control mb-2" placeholder="Playlist name">
    <textarea id="editPlaylistDesc" class="form-control mb-2" placeholder="Playlist description"></textarea>
    
    <label class="form-label text-white">Upload Cover Image</label>
    <input type="file" id="coverImageInput" class="form-control mb-3" accept="image/*">
    
    <button class="btn btn-success w-100 mb-2" onclick="saveEditedPlaylist()">Save Changes</button>
    <button class="btn btn-outline-light w-100" onclick="closeEditPlaylistModal()">Cancel</button>
  </div>
</div>

  <!-- Share Modal -->
  <div id="shareModal" class="custom-modal">
    <div class="custom-modal-dialog text-center">
      <h5>Share This Song</h5>
      <input id="shareLinkInput" type="text" class="form-control my-3" readonly>
      <button class="btn btn-success w-100 mb-2" onclick="copyShareLink()">Copy Link</button>
      <button class="btn btn-outline-light w-100" onclick="closeShareModal()">Close</button>
    </div>
  </div>

<div class="album-header">
  <div class="cover-section">
    <div style="position: relative;">
     <img id="playlistCover" src="https://via.placeholder.com/150" class="cover-image" alt="Playlist Cover">
     <div class="dropdown-item" onclick="shareSong(${songIndex})"></div>
     <button class="dropdown-button" onclick="toggleDropdownMenu(event)">...</button>
      <div id="dropdownMenu" class="dropdown-menu">
        <div class="dropdown-item" onclick="openEditPlaylistModal()">Edit Playlist</div>
        
        <div class="dropdown-item" onclick="removePlaylist()">Remove Playlist</div>
        <div class="dropdown-item" onclick="closeDropdownMenu()">Cancel</div>
      </div>
  </div>
</div>  

  <div class="playlist-details">
    <h2 id="playlistTitle" contenteditable="true" style="cursor: text;">Untitled Playlist</h2>
    <p id="playlistDesc" contenteditable="true" style="color: #bbb; cursor: text;">Click to add a description...</p>
  </div>
</div>

<div class="heading">
  <ul class="heading-info" style="list-style: none;" >
    <li class="heading-no">Album</li>
    <li class="heading-title" >Title</li>
    <li class="heading-album" ></li>
  </ul>
</div>

<!-- Copy Notification -->
<div id="copyNotification" style="position: fixed; bottom: 20px; right: 20px; background-color: #1db954; color: white; padding: 10px 20px; border-radius: 8px; display: none; z-index: 999;">Link copied!</div>
<div class="dropdown-item" onclick="shareSong(${songIndex})"></div>

<div id="songsContainer"></div>

<!-- Playlist Selection Modal -->
<div id="playlistSelectModal" class="custom-modal">
  <div class="custom-modal-dialog">
    <h5>Select or Create Playlist</h5>
    <div id="existingPlaylists" class="mb-3"></div>
    <input type="text" id="newPlaylistName" class="form-control mb-2" placeholder="New playlist name">
    <button class="btn btn-success w-100 mb-2" onclick="createNewPlaylist()">Create New Playlist</button>
    <button class="btn btn-outline-light w-100" onclick="closePlaylistSelectModal()">Cancel</button>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>


<script>
  function openEditPlaylistModal() {
    document.getElementById('editPlaylistName').value = playlist.name || '';
    document.getElementById('editPlaylistDesc').value = playlist.description || '';
    document.getElementById('editPlaylistModal').classList.add('show');
  }

  function closeEditPlaylistModal() {
    document.getElementById('editPlaylistModal').classList.remove('show');
  }

  function saveEditedPlaylist() {
    const name = document.getElementById('editPlaylistName').value.trim();
    const desc = document.getElementById('editPlaylistDesc').value.trim();
    const fileInput = document.getElementById('coverImageInput');

    if (name) playlist.name = name;
    playlist.description = desc;

    if (fileInput.files.length > 0) {
      const reader = new FileReader();
      reader.onload = function(e) {
        playlist.cover = e.target.result;
        updatePlaylistUI();
        savePlaylistToStorage();
      };
      reader.readAsDataURL(fileInput.files[0]);
    } else {
      updatePlaylistUI();
      savePlaylistToStorage();
    }

    closeEditPlaylistModal();
  }

  function updatePlaylistUI() {
    document.getElementById('playlistTitle').innerText = playlist.name;
    document.getElementById('playlistDesc').innerText = playlist.description;
    if (playlist.cover) {
      document.getElementById('playlistCover').src = playlist.cover;
    }
  }

  function savePlaylistToStorage() {
    playlists[playlistIndex] = playlist;
    localStorage.setItem('playlists', JSON.stringify(playlists));
  }

  function shareSong(songIndex) {
    const baseUrl = window.location.origin;
    const song = playlist.songs[songIndex];
    const link = `${baseUrl}/right-footage.html?songTitle=${encodeURIComponent(song.title)}&artist=${encodeURIComponent(song.artist)}&src=${encodeURIComponent(song.src)}&videoSrc=${encodeURIComponent(song.videoSrc || '')}`;

    navigator.clipboard.writeText(link).then(() => {
      showCopyNotification();
    }).catch(() => {
      alert('Failed to copy link!');
    });
  }

  function showCopyNotification() {
    const note = document.getElementById('copyNotification');
    note.style.display = 'block';
    setTimeout(() => {
      note.style.display = 'none';
    }, 2000);
  }

  function shareSongModal(songIndex) {
    const baseUrl = window.location.origin;
    const song = playlist.songs[songIndex];
    const link = `${baseUrl}/right-footage.html?songTitle=${encodeURIComponent(song.title)}&artist=${encodeURIComponent(song.artist)}&src=${encodeURIComponent(song.src)}&videoSrc=${encodeURIComponent(song.videoSrc || '')}`;

    document.getElementById('shareLinkInput').value = link;
    document.getElementById('shareModal').classList.add('show');
  }

  function closeShareModal() {
    document.getElementById('shareModal').classList.remove('show');
  }

  function copyShareLink() {
    const input = document.getElementById('shareLinkInput');
    input.select();
    document.execCommand('copy');

    showCopyNotification();
  }

  const urlParams = new URLSearchParams(window.location.search);
  const playlistIndex = urlParams.get('playlistIndex');
  let playlists = JSON.parse(localStorage.getItem('playlists')) || [];
  const playlist = playlists[playlistIndex];
  const songsContainer = document.getElementById('songsContainer');
  let selectedSongIndex = null;

  function playSong(song) {
    window.parent.postMessage({
      type: 'updatePlayer',
      songList: playlist.songs,
      song: song
    }, '*');
  }

  function loadSongs() {
    if (!playlist) {
      songsContainer.innerHTML = '<div>No playlist found!</div>';
      return;
    }

    document.getElementById('playlistCover').src = playlist.cover || 'https://via.placeholder.com/150';
    document.getElementById('playlistTitle').innerText = playlist.name || 'Untitled Playlist';
    document.getElementById('playlistDesc').innerText = playlist.description || 'Click to add a description...';

    function getArtistName(artist) {
  if (Array.isArray(artist)) {
    return artist.map(a => a.name || a).join(', ');
  } else if (typeof artist === 'object') {
    return artist.name || 'Unknown Artist';
  } else {
    return artist || 'Unknown Artist';
  }
}



    playlist.songs.forEach((song, songIndex) => {
      const songRow = document.createElement('div');
      songRow.className = 'song-row';
      songRow.innerHTML = `
        <img src="${song.thumb || 'https://via.placeholder.com/50x50.png?text=No+Image'}" class="song-thumb" alt="Thumb">
        <div class="song-info">
          <p class="song-title">${song.title}</p>
          
          <p class="song-artist">${getArtistName(song.artist)}</p>


        </div>
        <button class="dropdown-button">⋮</button>
        <div class="dropdown-menu">
          <div class="dropdown-item" onclick="showAddToPlaylistOptions(${songIndex}); event.stopPropagation()">Add to Playlist</div>
          <div class="dropdown-item" onclick="goToAlbum('${song.albumId}'); event.stopPropagation()">Go to Album</div>
          <div class="dropdown-item" onclick="removeFromPlaylist(${songIndex}); event.stopPropagation()">Remove from Playlist</div>
          <div class="dropdown-item" onclick="shareSong(${songIndex}); event.stopPropagation()">Share</div>
          <div class="dropdown-item" onclick="this.parentElement.style.display='none'; event.stopPropagation()">Cancel</div>
        </div>
      `;

      songRow.addEventListener('click', () => {
        playSong(song);
      });

      const dropdownButton = songRow.querySelector('.dropdown-button');
      const dropdownMenu = songRow.querySelector('.dropdown-menu');

      dropdownButton.addEventListener('click', (e) => {
        e.stopPropagation();
        const isVisible = dropdownMenu.style.display === 'block';
        dropdownMenu.style.display = isVisible ? 'none' : 'block';
      });

      songsContainer.appendChild(songRow);
    });
  }

  function goToAlbum(albumId) {
    if (albumId) {
      window.location.href = `songaddplaylist.html?albumId=${albumId}`;
    } else {
      alert("Album ID missing for this song!");
    }
  }

  function removeFromPlaylist(songIndex) {
    if (confirm("Are you sure you want to remove this song from the playlist?")) {
      playlist.songs.splice(songIndex, 1);
      playlists[playlistIndex] = playlist;
      localStorage.setItem('playlists', JSON.stringify(playlists));
      songsContainer.innerHTML = '';
      loadSongs();
    }
  }

  function removePlaylist() {
    if (confirm("Are you sure you want to delete this entire playlist?")) {
      playlists.splice(playlistIndex, 1);
      localStorage.setItem('playlists', JSON.stringify(playlists));
      window.location.href = '';
    }
  }

  function toggleDropdownMenu(event) {
    const dropdownMenu = document.getElementById('dropdownMenu');
    const isVisible = dropdownMenu.style.display === 'block';
    dropdownMenu.style.display = isVisible ? 'none' : 'block';
  }

  function closeDropdownMenu() {
    document.getElementById('dropdownMenu').style.display = 'none';
  }

  function showAddToPlaylistOptions(songIndex) {
    selectedSongIndex = songIndex;
    const existingPlaylistsDiv = document.getElementById('existingPlaylists');
    existingPlaylistsDiv.innerHTML = '';

    playlists.forEach((pl, index) => {
      const plDiv = document.createElement('div');
      plDiv.className = 'playlist-option';
      plDiv.innerText = pl.name || `Untitled Playlist ${index + 1}`;
      plDiv.onclick = () => {
        const originalSong = playlist.songs[songIndex];
        const songToAdd = { ...originalSong };

        if (!songToAdd.albumId) {
          songToAdd.albumId = generateRandomAlbumId();
        }

        playlists[index].songs.push(songToAdd);
        localStorage.setItem('playlists', JSON.stringify(playlists));
        closePlaylistSelectModal();
        alert(`Song added to "${pl.name}"`);
      };
      existingPlaylistsDiv.appendChild(plDiv);
    });

    document.getElementById('playlistSelectModal').classList.add('show');
  }

  function generateRandomAlbumId() {
    return 'album-' + Math.random().toString(36).substr(2, 9);
  }

  function closePlaylistSelectModal() {
    document.getElementById('playlistSelectModal').classList.remove('show');
  }

  function createNewPlaylist() {
    const newPlaylistName = document.getElementById('newPlaylistName').value.trim();
    if (newPlaylistName) {
      const newPlaylist = {
        name: newPlaylistName,
        songs: []
      };
      playlists.push(newPlaylist);
      localStorage.setItem('playlists', JSON.stringify(playlists));
      closePlaylistSelectModal();
      alert('New playlist created!');
    }
  }

  loadSongs();




  window.addEventListener('load', function() {
    const colorThief = new ColorThief();
    const image = document.getElementById('playlistCover');

    if (image.complete) {
      applyGradient();
    } else {
      image.addEventListener('load', applyGradient);
    }

    function applyGradient() {
      const dominantColor = colorThief.getColor(image);
      const [r, g, b] = dominantColor;
      const gradient = `linear-gradient(to bottom, rgb(${r}, ${g}, ${b}), #121212)`;

      const header = document.querySelector('.album-header');
      header.style.background = gradient;
    }
  });




</script>

</body>
</html>
